#!/usr/bin/env python3

# This script is equivalent to
#
#     sed -i '1i# File generated by ./configure; DO NOT EDIT.\n\n'
#
# with GNU sed.  So why write a multi-line script?  Because macOS sed
# is so aggressively terrible.
#  1. '-i' doesn't have a mode to not create a backup file that we'd
#     just have to delete later.
#  2. The 'i' command requires a backslash-newline before the text
#     starts, and that's really hard to quote with macOS's ancient GNU
#     Make 3.81.
#  3. The '1' addr only triggers on the first file when editing
#     multiple files.  This is the real reason, as changing from `find
#     -exec +` to `find -exec \;` is too much of a slowdown.

import fileinput
import sys


for line in fileinput.input(inplace=True):
    if fileinput.isfirstline():
        sys.stdout.write('# File generated by ./configure; DO NOT EDIT.\n\n')
    sys.stdout.write(line)
